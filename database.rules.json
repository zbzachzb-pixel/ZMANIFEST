{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null",

    "users": {
      "$uid": {
        ".read": "auth != null",
        ".write": "auth != null && (
          auth.uid == $uid ||
          root.child('users').child(auth.uid).child('role').val() == 'admin'
        )",
        ".indexOn": ["role", "email"]
      }
    },

    "loads": {
      ".read": "auth != null",
      ".write": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".indexOn": ["status", "position", "createdAt"]
    },

    "funJumperRequests": {
      "$requestId": {
        ".read": "auth != null",
        ".write": "auth != null && (
          root.child('users').child(auth.uid).child('role').val() == 'admin' ||
          root.child('users').child(auth.uid).child('role').val() == 'manifest' ||
          (!data.exists() && newData.child('userId').val() == auth.uid)
        )",
        ".indexOn": ["status", "createdAt", "userId", "updatedAt"]
      }
    },

    "instructors": {
      ".read": "auth != null",
      ".write": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".indexOn": ["uid", "status"]
    },

    "queue": {
      ".read": "auth != null",
      ".write": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".indexOn": ["position", "addedAt"]
    },

    "assignments": {
      ".read": "auth != null",
      ".write": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".indexOn": ["loadId", "instructorId", "createdAt", "timestamp"]
    },

    "actionHistory": {
      ".read": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".write": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".indexOn": ["timestamp", "actionType"]
    },

    "messages": {
      "$messageId": {
        ".read": "auth != null",
        ".write": "auth != null && (
          root.child('users').child(auth.uid).child('role').val() == 'admin' ||
          root.child('users').child(auth.uid).child('role').val() == 'manifest' ||
          (data.exists() && (
            newData.child('readBy').child(auth.uid).exists() ||
            newData.child('acknowledgedBy').child(auth.uid).exists()
          ))
        )",
        ".indexOn": ["recipientType", "recipientId", "createdAt", "senderId"]
      }
    },

    "aircraft": {
      ".read": "auth != null",
      ".write": "auth != null && (
        root.child('users').child(auth.uid).child('role').val() == 'admin' ||
        root.child('users').child(auth.uid).child('role').val() == 'manifest'
      )",
      ".indexOn": ["isActive", "order", "tailNumber"]
    }
  }
}
